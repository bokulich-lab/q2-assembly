{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "params": [
    {
      "name": "category_param",
      "value": "group"
    },
    {
      "name": "value_param",
      "value": "All"
    },
    {
      "name": "highlight_samples_param",
      "value": []
    }
  ],
  "description": "GC content distribution (KDE)",
  "data": {
    "url": "data/gc_content_data.arrow",
    "format": {"type": "arrow"}
  },
  "transform": [
    {
      "filter": "value_param == 'All' || datum[category_param] == value_param"
    },
    {
      "density": "gc",
      "groupby": [
        "sample"
      ],
      "as": [
        "gc",
        "density"
      ]
    },
    {
      "calculate": "datum[category_param]",
      "as": "metadata_category_value"
    },
    {
      "calculate": "indexof(pluck(highlight_samples_param, 'sample'), datum.sample) !== -1 ? 1 : 0",
      "as": "selection_order"
    }
  ],
  "mark": {
    "type": "line",
    "interpolate": "monotone",
    "strokeWidth": 2.5
  },
  "width": "container",
  "height": 350,
  "selection": {
    "grid": {
      "type": "interval",
      "bind": "scales"
    }
  },
  "encoding": {
    "x": {
      "field": "gc",
      "type": "quantitative",
      "title": "GC content (%)",
      "bin": false
    },
    "y": {
      "field": "density",
      "type": "quantitative",
      "title": "Fraction of contigs"
    },
    "order": {
      "field": "selection_order",
      "type": "quantitative",
      "sort": "descending"
    },
    "color": {
      "field": "sample",
      "type": "nominal",
      "scale": {
        "scheme": "viridis"
      },
      "sort": "ascending",
      "legend": null
    },
    "opacity": {
      "condition": {
        "test": "indexof(pluck(highlight_samples_param, 'sample'), datum.sample) !== -1",
        "value": 0.8
      },
      "value": 0.1
    },
    "tooltip": [
      {"field": "sample", "type": "nominal", "title": "Sample"},
      {"field": "gc", "type": "quantitative", "title": "GC content (%)", "format": ".1f"},
      {"field": "density", "type": "quantitative", "title": "Density", "format": ".3f"}
    ]
  },
  "config": {
    "background": "#fff",
    "font": "Open Sans, Arial, sans-serif",
    "axis": {
      "grid": true,
      "gridColor": "#eaeaea",
      "gridWidth": 1,
      "tickColor": "#888",
      "labelFont": "Open Sans, Arial, sans-serif",
      "labelFontSize": 14,
      "titleFont": "Open Sans, Arial, sans-serif",
      "titleFontSize": 16,
      "titleFontWeight": "bold",
      "domain": false
    },
    "legend": {
      "orient": "top",
      "columns": {{ n_cols }},
      "title": "Sample",
      "padding": 10,
      "labelFont": "Open Sans, Arial, sans-serif",
      "labelFontSize": 14,
      "titleFont": "Open Sans, Arial, sans-serif",
      "titleFontSize": 15,
      "symbolType": "circle",
      "symbolSize": 120,
      "symbolLimit": 100
    },
    "view": {
      "stroke": "#eaeaea",
      "strokeWidth": 1
    },
    "title": {
      "font": "Open Sans, Arial, sans-serif",
      "fontSize": 18,
      "fontWeight": "bold",
      "anchor": "middle",
      "color": "#222"
    }
  },
  "title": "GC content distribution"
} 