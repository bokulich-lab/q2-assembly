{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "params": [
    {"name": "category_param", "value": "group"},
    {"name": "value_param", "value": "All"}
  ],
  "vconcat": [
    {
      "hconcat": [
        {
          "title": "Contig Length Distribution",
          "data": {"values": {{ seq_df | safe }}},
          "transform": [
            {"filter": "value_param == 'All' || datum[category_param] == value_param"},
            {"calculate": "log(datum.contig_length)/log(10)", "as": "log_x"},
            {"bin": true, "field": "log_x", "as": "bin_log_x"},
            {"calculate": "pow(10, datum.bin_log_x)", "as": "x1"},
            {"calculate": "pow(10, datum.bin_log_x_end)", "as": "x2"}
          ],
          "mark": "bar",
          "width": 400, "height": 350,
          "selection": {
            "sample_select": {
              "type": "multi",
              "fields": ["sample"],
              "bind": "legend"
            },
            "grid": {"type": "interval", "bind": "scales", "encodings": ["x"]}
          },
          "encoding": {
{#            "x": {"field": "x1", "title": "Contig Length", "scale": {"type": "log", "base": 10, "domainMin": 1}},#}
            "x": {"field": "x1", "title": "Contig Length", "axis": {"format": ".0f"}},
            "x2": {"field": "x2"},
            "y": {"aggregate": "count", "title": "Count"},
            "color": {"field": "sample", "type": "nominal", "scale": {"scheme": "viridis"}, "legend": {"orient": "right"}},
            "opacity": {
              "condition": {"param": "sample_select", "value": 1},
              "value": 0.2
            },
          }
        },
        {
          "title": "Nx Curve per Sample",
          "data": {"values": {{ nx_df | safe }}},
          "transform": [{"filter": "value_param == 'All' || datum[category_param] == value_param"}],
          "mark": {"type": "line", "point": true},
          "width": 400, "height": 350,
          "selection": {
            "sample_select": {
              "type": "multi",
              "fields": ["sample"],
              "bind": "legend"
            },
            "grid": {"type": "interval", "bind": "scales"}
          },
          "encoding": {
            "x": {"field": "percent", "type": "quantitative", "title": "Percent of Assembly (Nx)"},
            "y": {"field": "nx", "type": "quantitative", "title": "Contig Size (bp)"},
            "color": {"field": "sample", "type": "nominal", "scale": {"scheme": "viridis"}, "legend": {"orient": "right"}},
            "opacity": {
              "condition": {"param": "sample_select", "value": 1},
              "value": 0.2
            }
          }
        }
      ],
      "spacing": 30
    },
    {
      "hconcat": [
        {
          "title": "GC Content Distribution (KDE)",
          "data": {"values": {{ seq_df | safe }}},
          "transform": [
            {"filter": "value_param == 'All' || datum[category_param] == value_param"},
            {"density": "gc", "groupby": ["sample"], "as": ["gc", "density"]}
          ],
          "mark": {"type": "line", "interpolate": "monotone"},
          "width": 400, "height": 350,
          "selection": {
            "sample_select": {
              "type": "multi",
              "fields": ["sample"],
              "bind": "legend"
            },
            "grid": {"type": "interval", "bind": "scales"}
          },
          "encoding": {
            "x": {"field": "gc", "type": "quantitative", "title": "GC Content (%)", "bin": false},
            "y": {"field": "density", "type": "quantitative", "title": "Density"},
            "color": {"field": "sample", "type": "nominal", "scale": {"scheme": "viridis"}, "legend": {"orient": "right"}},
            "opacity": {
              "condition": {"param": "sample_select", "value": 1},
              "value": 0.2
            }
          }
        },
        {
          "title": "Cumulative Contig Length Curves",
          "data": {"values": {{ cumulative_df | safe }}},
          "transform": [{"filter": "value_param == 'All' || datum[category_param] == value_param"}],
          "mark": {"type": "line", "point": true},
          "width": 400, "height": 350,
          "selection": {
            "sample_select": {
              "type": "multi",
              "fields": ["sample"],
              "bind": "legend"
            },
            "grid": {"type": "interval", "bind": "scales"}
          },
          "encoding": {
            "x": {"field": "rank", "type": "quantitative", "title": "No. of Contigs"},
            "y": {"field": "cumulative_length", "type": "quantitative", "title": "Cumulative Length"},
            "color": {"field": "sample", "type": "nominal", "scale": {"scheme": "viridis"}, "legend": {"orient": "right"}},
            "opacity": {
              "condition": {"param": "sample_select", "value": 1},
              "value": 0.2
            }
          }
        }
      ],
      "spacing": 30
    }
  ],
  "spacing": 30,
  "config": {
    "background": "#fff",
    "font": "Open Sans, Arial, sans-serif",
    "axis": {
      "grid": true,
      "gridColor": "#eaeaea",
      "gridWidth": 1,
      "tickColor": "#888",
      "labelFont": "Open Sans, Arial, sans-serif",
      "labelFontSize": 14,
      "titleFont": "Open Sans, Arial, sans-serif",
      "titleFontSize": 16,
      "titleFontWeight": "bold",
      "domain": false
    },
    "legend": {
      "orient": "top",
      "labelFont": "Open Sans, Arial, sans-serif",
      "labelFontSize": 14,
      "titleFont": "Open Sans, Arial, sans-serif",
      "titleFontSize": 15,
      "symbolType": "circle",
      "symbolSize": 120
    },
    "view": {
      "stroke": "#eaeaea",
      "strokeWidth": 1
    },
    "header": {
      "labelFont": "Open Sans, Arial, sans-serif",
      "labelFontSize": 15,
      "titleFont": "Open Sans, Arial, sans-serif",
      "titleFontSize": 17
    },
    "title": {
      "font": "Open Sans, Arial, sans-serif",
      "fontSize": 18,
      "fontWeight": "bold",
      "anchor": "middle",
      "color": "#222"
    }
  }
} 